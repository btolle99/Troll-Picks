<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>First Goal Engine</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- EXTERNAL CSS -->
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="shell">

    <header>
      <div class="nav-inner">
        <a class="nav-left">
          <div class="logo-mark">FG</div>
          <span class="brand-label">First Goal Engine</span>
        </a>
        <nav class="nav-links">
          <span class="nav-link active">Today</span>
          <span class="nav-link">Odds</span>
          <span class="nav-link">Performance</span>
          <span class="nav-link">About</span>
        </nav>
      </div>
    </header>

    <main>
      <section class="hero">
        <h1>Today&apos;s NHL First Goal Board</h1>
        <p class="text-muted">Model-driven first goal edges across books, game by game.</p>
        <p class="text-muted hero-subline">Today • <span id="today-date"></span></p>

        <div class="kpis">
          <div class="kpi-card">
            <div class="kpi-label">All Time P/L</div>
            <div class="kpi-value"><span id="kpi-units">+0.0u</span></div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">Hit rate per game</div>
            <div class="kpi-value"><span id="kpi-hit">0.0%</span></div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">ROI</div>
            <div class="kpi-value"><span id="kpi-ev">0.0%</span></div>
          </div>
        </div>
      </section>

      <!-- FILTERS -->
      <section class="filters">
        <div class="segmented">
          <button id="btnPlays" class="active">Plays</button>
          <button id="btnPlaysLeans">Plays &amp; leans</button>
        </div>

        <div class="filter-row">
          <div>
            <span class="text-muted">Book</span>
            <select class="pill-select" id="bookSelect">
              <option value="ALL">All books</option>
              <option value="FANDUEL">FanDuel</option>
              <option value="DRAFTKINGS">DraftKings</option>
              <option value="BETMGM">BetMGM</option>
              <option value="ESPN BET">ESPN BET</option>
              <option value="HARD ROCK BET">Hard Rock Bet</option>
            </select>
          </div>
        </div>
      </section>

      <section class="games-list" id="gamesList"></section>

    </main>
  </div>

  <!-- SCRIPTS -->
  <script>
    const SHEET_API_URL = "https://script.google.com/macros/s/AKfycbwZ5pD8aFMAkRIE3qMfXfyHVdEp7RVhLsvhisDPHgVEKwQPFaViL2wtiJFgfC5ukanB/exec";

    let games = [];
    let viewMode = "plays";
    let bookFilter = "ALL";

    const gamesListEl = document.getElementById("gamesList");

    /* ---- TEAM LOGO FIX ---- */
    const ESPN_SLUGS = {
      "TBL": "tb",
      "LAK": "la",
      "VGK": "vgk",
      "NJD": "nj",
      "SJS": "sj",
      "WSH": "wsh",
      "CBJ": "cbj",
      "MTL": "mtl",
      "NYR": "nyr",
      "NYI": "nyi",
      "PIT": "pit",
      "BOS": "bos",
      "DET": "det",
      "CHI": "chi",
      "DAL": "dal",
      "COL": "col",
      "FLO": "fla",
      "FLA": "fla",
      "EDM": "edm",
      "CGY": "cgy",
      "VAN": "van",
      "SEA": "sea",
      "BUF": "buf",
      "PHI": "phi",
      "CAR": "car",
      "OTT": "ott",
      "MIN": "min",
      "WPG": "wpg",
      "STL": "stl",
      "ARI": "ari",
      "ANA": "ana",
      "TOR": "tor"
    };

    function getSlug(team) {
      const code = (team || "").trim().toUpperCase();
      return ESPN_SLUGS[code] || code.toLowerCase();
    }

    /* --- formats --- */
    function formatPercent(v) { return (v * 100).toFixed(1) + "%"; }
    function formatOdds(v) { return v > 0 ? "+" + v : v; }
    function normalizeBook(raw) { return (raw || "").toString().trim().toUpperCase(); }

    /* ---- TAG HELPERS ---- */
    function tagValue(m) { return (m.tag || "").trim().toUpperCase(); }
    function isPlay(m) { return tagValue(m) === "PLAY"; }
    function isLean(m) { return tagValue(m) === "LEAN"; }

    /* ---- BOOK LOGO HELPERS ---- */
    function bookShortName(raw) {
      const name = normalizeBook(raw);
      if (name.includes("FANDUEL")) return "FD";
      if (name.includes("DRAFTKINGS")) return "DK";
      if (name.includes("ESPN")) return "ESPN";
      if (name.includes("BETMGM")) return "MGM";
      if (name.includes("BET365")) return "365";
      if (name.includes("CAESARS")) return "CZ";
      if (name.includes("HARD ROCK")) return "HR";
      return "?";
    }

    function bookClass(raw) {
      const name = normalizeBook(raw);
      if (name.includes("FANDUEL")) return "book-fd";
      if (name.includes("DRAFTKINGS")) return "book-dk";
      if (name.includes("ESPN")) return "book-espn";
      if (name.includes("BETMGM")) return "book-mgm";
      if (name.includes("BET365")) return "book-365";
      if (name.includes("CAESARS")) return "book-caesars";
      return "";
    }

    function getBookLogoHtml(raw) {
      return `<span class="book-logo ${bookClass(raw)}">${bookShortName(raw)}</span>`;
    }

    /* ---- RENDER ---- */
    <script>
  // ...keep your constants + helpers above (SHEET_API_URL, ESPN_SLUGS, getSlug, etc.)

  function render() {
    gamesListEl.innerHTML = "";
    let any = false;

    games.forEach((g) => {
      const allMarkets = g.markets || [];

      const playCount = allMarkets.filter(isPlay).length;
      const leanCount = allMarkets.filter(isLean).length;

      let markets = allMarkets.slice();

      if (viewMode === "plays") {
        markets = markets.filter(isPlay);
      }

      if (bookFilter !== "ALL") {
        markets = markets.filter(
          (m) => normalizeBook(m.book) === bookFilter
        );
      }

      if (markets.length === 0) return;
      any = true;

      const awaySlug = getSlug(g.awayTeam);
      const homeSlug = getSlug(g.homeTeam);

      const card = document.createElement("article");
      card.className = "game-card";

      card.innerHTML = `
        <header class="game-header">
          <div style="display:flex; align-items:center; gap:10px;">
            <img class="team-logo" src="https://a.espncdn.com/i/teamlogos/nhl/500/${awaySlug}.png" />
            <div class="game-title">${(g.awayTeam || "").toUpperCase()}</div>
            <div style="color:#64748b;font-size:12px;">@</div>
            <div class="game-title">${(g.homeTeam || "").toUpperCase()}</div>
            <img class="team-logo" src="https://a.espncdn.com/i/teamlogos/nhl/500/${homeSlug}.png" />
          </div>
          <div style="display:flex; flex-direction:column; align-items:flex-end;">
            <span class="plays-summary">${playCount} Plays • ${leanCount} Leans</span>
          </div>
        </header>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Player</th>
                <th>Team</th>
                <th class="align-right">FG Rank</th>
                <th class="align-right">EV %</th>
                <th class="align-right">Best Odds</th>
                <th>Book</th>
                <th class="align-right">Units</th>
                <th class="align-right">Score</th>
                <th>Tag</th>
              </tr>
            </thead>
            <tbody>
              ${markets
                .sort((a, b) => a.fgRank - b.fgRank)
                .map((m) => {
                  const t = tagValue(m);
                  const tagHtml =
                    t === "PLAY"
                      ? '<span class="tag-pill tag-play">PLAY</span>'
                      : t === "LEAN"
                      ? '<span class="tag-pill tag-lean">LEAN</span>'
                      : '<span class="tag-pill tag-pass">PASS</span>';

                  return `
                    <tr class="${isPlay(m) ? "play-row" : ""}">
                      <td>${m.player}</td>
                      <td>${m.team}</td>
                      <td class="align-right">${m.fgRank}</td>
                      <td class="align-right">${formatPercent(m.ev)}</td>
                      <td class="align-right">${formatOdds(m.bestOdds)}</td>
                      <td>${getBookLogoHtml(m.book)}</td>
                      <td class="align-right">${m.units != null ? m.units.toFixed(2) + "u" : ""}</td>
                      <td class="align-right">${Number(m.score).toFixed(2)}</td>
                      <td>${tagHtml}</td>
                    </tr>
                  `;
                })
                .join("")}
            </tbody>
          </table>
        </div>
      `;

      gamesListEl.appendChild(card);
    });

    if (!any) {
      gamesListEl.innerHTML =
        '<p class="text-muted">No markets match filters.</p>';
    }
  }

  // ...rest of your JS: loadData(), DOMContentLoaded, etc.
</script>


    /* ---- DATA ---- */
    async function loadData() {
      const res = await fetch(SHEET_API_URL);
      const json = await res.json();
      games = json.games || [];
      render();
    }

    /* ---- INIT ---- */
    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("today-date").textContent =
        new Date().toLocaleDateString();

      document.getElementById("btnPlays").onclick = () => {
        viewMode = "plays"; render();
      };
      document.getElementById("btnPlaysLeans").onclick = () => {
        viewMode = "playsLeans"; render();
      };
      document.getElementById("bookSelect").onchange = (e) => {
        bookFilter = e.target.value.toUpperCase(); render();
      };

      loadData();
    });
  </script>

</body>
</html>
